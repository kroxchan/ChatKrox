# 2026-02-25

- 渠道切换：QQ 插件已不可用，后续与 ChenZhengKang 通过企业微信（WeCom）交互。
- 联系人映射：以 WeCom `sender_id` 为唯一标识；ChenZhengKang 为主联系人（本人）。
- 家人会话已出现：wecom:guancanghai / wecom:zb / wecom:xuyuanyouyizhangmenglian / wecom:wuyouping。
- 已确认：XuYuanYouYiZhangMengLian 为老婆（称呼偏好："老婆"）。
- 已确认（来自 ChenZhengKang）：WuYouPing 为外婆（称呼：家家）；ZB 为妈妈。
- 待二次核实：GuanCangHai 为爸爸。
- 隐私边界：家人对话内容无需同步给本人；仅在对应会话内回复。
- 工作准则（P0）：对 ChenZhengKang 的消息，必须先核实再回复（查日志/工具/文件），避免凭印象。
- 工作准则（信息查询）：任何用户向我索取“需要获取信息”的内容时，必须使用所有可用联网手段进行检索与交叉验证（至少 5 个信息源，包含但不限于 `web_fetch` / `web_search` / 浏览器），确保准确；并逐步建立“需求→工具”的匹配：凡是周边/地点/路线/POI 等位置相关问题，优先使用高德地图 AMap 工具链。
- 工作准则（迭代进化）：凡是遇到我没有解决好的问题，后续由用户/他人帮我解决或给出新路径时，必须把“新路径/新 SOP/排障结论/工具选型”写入记忆文件（`memory/YYYY-MM-DD.md` + 必要时 `WORKFLOW_AUTO.md` / `MEMORY.md`），确保下次可复用。
- 其他 agent/evomap：当前环境 `agents_list` 仅允许 `main`，暂无法直接借用其他 agent 会话；技能列表中未看到名为 `evomap`/`amap` 的技能。用户澄清：高德地图=AMap；`evomap` 是 GitHub 上的一个项目（需后续定位 repo 并决定安装/接入方式）。
- Cron 迁移：已确定迁移策略与稳定投递范式；当前以“逐条重建 v2 + disable 旧任务”为主（优先保证送达与可验收）。
- Cron/WeCom 排障：`message send` 可达但 cron 投递多次不达，根因多为 job `delivery` 字段被清空/覆盖（`main + systemEvent` 版本经常丢失 delivery，`isolated + agentTurn + delivery.announce` 版本可稳定投递）。建议早安任务最终定型为 `isolated + agentTurn` 并保留 `delivery={mode:announce, channel:wecom, to:ChenZhengKang}`。
- Gateway/heartbeat 报错：日志持续出现 WeCom `errcode 81013 invaliduser:"heartbeat"`，来源为 `gateway/heartbeat` 子系统给无效收件人 heartbeat 发送导致；`openclaw.json` 的 `channels` 为空，需进一步定位配置来源。
- WeCom 发送不稳定：在 Windows 上执行 `openclaw message send --channel wecom ...` 会出现“Sent 后立刻崩溃”现象（`Assertion failed: !(handle->flags & UV_HANDLE_CLOSING), file src\\win\\async.c`），导致用户侧偶发显示 Connection error；gateway RPC probe 仍为 ok。建议减少密集手动验收触发，改为抽样验收。

## 复盘（近24h会话抽取）

### 关键学习/模式
- 稳定投递范式：`sessionTarget=isolated` + `payload.kind=agentTurn` + `delivery={mode:announce, channel:wecom, to:<sender_id>}` 的可靠性明显高于 `main + systemEvent`。
- “推倒重建”优先于“批量改写”：jobs.json 写回后读回不生效，疑似存在另一份 store/state 或进程覆盖；逐条改 + 立刻 `cron run` 验收更可控。
- 联系人体系要以 sender_id 为锚：避免名称/备注变动导致串人；对家人会话遵循最小披露。

### 易错点/坑
- Cron job 的 `delivery` 容易在 main/systemEvent 路径丢失或被覆盖，导致“执行了但没送达”。
- Windows 下 WeCom 发送存在 uv handle closing 崩溃风险，密集测试会放大体感故障。
- heartbeat 子系统会尝试对无效收件人发送（invaliduser:heartbeat），需要清理/修正配置来源。

### 用户偏好
- 对本人（ChenZhengKang）消息：必须先核实再回复（日志/工具/文件）。
- 外婆称呼固定为“家家”；老婆称呼偏好“老婆”。
- 自动化任务：更重视稳定送达与可验证性（cron run 验收），不追求花哨格式。

### 未完成事项
- 定位 cron job 存储/覆盖来源：为何批量修改 `C:\\Users\\Krox\\.openclaw\\cron\\jobs.json` 后未生效。
- 处理 `invaliduser:"heartbeat"` 的真实配置来源（openclaw.json channels 为空但仍在发）。
- 核实若干 v2 晨报 lastStatus=error 是否为历史遗留还是持续失败（需用 `cron runs`/重跑确认）。
- Chrome Relay token/auth 的官方配置路径仍未解决（需 `openclaw gateway --help` / `openclaw browser --help` 找命令生成/展示 token，再到扩展 Options 设置）。

- 批量迁移异常：尝试脚本批量把所有 `delivery.channel=wecom && mode=announce` 的 cron 从 `main+systemEvent` 改为 `isolated+agentTurn`，但写回 `C:\Users\Krox\.openclaw\cron\jobs.json` 后读回未生效（例如 job `21a30a26-7a2c-43e5-b993-ba015e6ad9a4` 仍为 `main/systemEvent`）。推测存在另一个 store/state 或进程覆盖，需要定位真实生效来源；短期策略为“逐条改 + 立刻 cron run 验收”。
- Cron 重建策略确定：为保证 WeCom 稳定投递，采用“推倒重建”——新建 `isolated + agentTurn + delivery(announce wecom->sender_id)` 的 v2/v3 任务，保留原 schedule/prompt 逻辑不变；旧任务统一 disable 防止重复。已创建并验证投递测试 job `dfed1af3-0222-4e3c-95a9-4f16554a962d`。
- 晨报重建与验收：主人晨报A/B/C 已重建并触发验收（v2 ids：`9015b633-9074-48de-b686-520dcbdfea60`/`5a9e8709-3c76-4de0-ba2f-d8060b3cdb1a`/`b44049ce-5db7-481b-bf4d-f0323f879ba5`），旧晨报A/B/C 已 disable（`289c4223-0933-4716-a3b8-cf4b4ad593bc`/`b315baa8-a84c-48a1-9974-6930870e1eef`/`28943865-633e-4442-a0b6-28b846615049`）。
- 家人晨报验收：晨报A/B/C 已创建并触发验收：家家A/B/C `e2481f40-c677-47bf-9695-c40a798be9a4`/`e2e0be01-4df4-4d7d-99fc-9d0d5bb283b7`/`ef6da8b2-f3cc-4ad0-8b0c-15f5b0b7d4d8`；妈妈A/B/C `a884cc86-fcac-45d1-804d-5dc9764d0379`/`9bac73e6-4962-4253-8f27-8e24fea9bbba`/`8e6a9874-b65c-42f6-a9cf-d73d7c6d783d`；爸爸A/B/C `5ff2f0c1-fb2f-459b-a2be-3e0faca42885`/`8a3d7112-29ff-4790-bd08-9738b4b4b8be`/`21544ae9-ec46-4612-9205-49c6f955fcaa`；老婆A/B/C `81dfe2ce-2447-4031-a8c1-51434c2c7347`/`de32ecf6-9c18-40dd-b5b5-15f2efe273b0`/`b7da8f3c-374b-42ee-9a75-bfbeca64bb80`。
- 家人早安重建与切换：已创建并触发验收早安 v2：家家 `49c2a28b-55a3-4643-86bc-1546187e76b6`、妈妈 `5c68ab1d-bd5e-48e0-b4b2-9936ff73ced3`、爸爸 `c170892c-8a34-4b08-ae63-5b3e7edc3b09`、老婆 `e542f8fd-9577-4f6d-975d-4e46b22347c1`；旧早安已 disable（`ebe0a430-8af0-47a1-b797-ed66d22100e2`/`01b7b749-d053-4eb2-9099-a0de2ba03baa`/`b71986e3-0d45-4951-84ed-bd8b21043d05`/`7623f3a9-b0b9-4a66-8cdb-df03e47bed77`）。
- 家人午安重建与切换：已创建并触发验收午安 v2：家家 `fc2a90e7-e4d5-405c-879d-845e7ac28b65`、妈妈 `0b9ec5c3-49a6-488b-9b03-98ce64fb9f02`、爸爸 `16e8786d-40d1-4738-a24b-8ea5431c8982`、老婆 `a5693687-f710-4c40-81c7-c96aff869043`；旧午安已 disable（`39f7415c-0c35-42e8-ba3d-dc1b80818089`/`7feb9347-16f4-422e-9b66-ef4889219240`/`786ebfe2-a974-44f7-a165-04a71be08e77`/`b9f92b5d-8799-485e-a3f7-6762b3712c8d`）。
- 家人晚安重建与切换：已创建并触发验收晚安 v2：家家 `fc19c0d9-a226-4556-9684-9fefa0ee7983`、妈妈 `2c814f98-1ae4-48e5-a59c-a0c25c09a166`、爸爸 `2884aadd-6fb4-407e-a2d1-cb60a1d6515f`、老婆 `7e35e469-a939-45c1-95d1-cf82a113f7de`；旧晚安已 disable（外婆 `145a4a7c-995d-4ca6-bc75-e260747d7fa5`、妈妈 `4afed129-2bdf-4657-85ab-067270537696`、老婆 `aac3b583-1498-46ca-9ae5-bab1de4bb1af`）。
- 残留任务已收尾（2026-02-25 夜）：已重建并切换 `harness自检-每日` 与 `Sophie上下文优化` 为 wecom v2（均为 `isolated+agentTurn+announce`）：`harness自检-每日(wecom)-v2` `dc49cac1-4e06-4596-9253-b68cdd617290`、`Sophie上下文优化(wecom)-v2` `6b5b143e-7e86-49bf-8b69-39d7f19137ee`；并 disable 旧 job `0612cff3-36da-4db4-be65-b9254dcd9478`、`287725d7-72b0-4128-a9ee-d2cbe423dc96`。
- 多余任务关闭：已 disable 旧 `早安-主人-真实天气金句` `5e2d2e52-d002-4912-bc77-9a75a07b6298`。
- Nightly intel prefetch：已按“学习/预取外界信息”用途重建为 v2：`59a07e8a-8c2a-4f04-9e13-e80c8dc8e0a1`（isolated/agentTurn；仍保持成功静默、失败提示；跑 `scripts/intel/prefetch.py` 写 `data/intel/last_run.txt`），并已 disable 旧 job `6e343d88-c2aa-48ed-8583-55289a679369`（旧版 main/systemEvent 曾报 `trim undefined`）。
- 仍显示 error 的 v2 晨报：主人晨报B/C `5a9e8709-3c76-4de0-ba2f-d8060b3cdb1a`/`b44049ce-5db7-481b-bf4d-f0323f879ba5`、家家晨报A `e2481f40-c677-47bf-9695-c40a798be9a4`、爸爸晨报A `5ff2f0c1-fb2f-459b-a2be-3e0faca42885`；需进一步通过 `cron runs` 判断是否为历史一次投递异常导致 lastStatus=error，或确实会持续失败。
- 复盘/回顾来源核实：`每周记忆回顾` 旧 job `d690905a-df1c-4201-ad4e-14062e981828`（main/systemEvent，调用本地脚本 `workspace-rescue/scripts/memory_system_hooks.py weekly`）曾成功跑过但有“announce delivery failed”。已重建为 wecom 稳定投递版 `c2c2fbd0-09c9-4dd7-a984-49b84ba8b8e1`（isolated/agentTurn/announce to ChenZhengKang），并已 disable 旧 job。
- 复盘/回顾来源核实：`夜间Compounding复盘` 旧 job `d5c67c9d-d190-4ddf-a921-8957f311617f`（main/systemEvent，指令包含 reflect-learn skill + 自动 git commit）近几天有执行记录但也出现过 announce delivery failed / payload kind 不一致。已重建为 wecom 稳定投递版 `02c7c714-352e-4980-bd6a-f264f7f57661`（isolated/agentTurn/announce to ChenZhengKang，且明确 Do NOT commit），并已 disable 旧 job。
- 冗余任务关闭：已 disable `每日晨报-9:30预采集-*`（`e7e665e2-3b88-4f5b-9852-3d7a63c6ccaf`/`d15ed1e9-e541-46b5-97b4-5d4f69232707`/`a53f4f1a-6ae4-417f-be8f-f9a338f00249`/`f1248ccf-520f-41b6-8dc5-7b095df8d5cb`）、disable `比特币监测-主人(wecom)` `cd890eeb-5e33-409a-a30a-43f0cce478da`、disable `daily_btc_analysis_wife` `49e83a43-6c89-486c-a41b-345c10878545`。
